<!DOCTYPE html>
<html lang="en">
  <title>WebSocket Game</title>
  <script src="/socket.io/socket.io.js"></script>
  <script type="module">
    import { html, Component, render } from 'https://unpkg.com/htm/preact/standalone.module.js';
    
    class App extends Component {
        constructor(props){
            super(props)
            this.socket = io();
            this.state = {
                cards: [{name: 'alice'}],
                playersCount: 0,
                gameStarted: false,
            }

            this.socket.on("data", (data) => {
                this.setState(data);
            });

            this.socket.on("cards", (cards) => {
                console.log(cards)
                this.setState({cards});
            });
        }

        startGameHandler() {
            this.socket.emit("startGame", true);
        }

        render() {
            const {cards, playersCount, gameStarted} = this.state;
            return html`
            <div>
                <p>${playersCount} player(s) connected</p>
                ${
                    gameStarted ? 
                    html`<p>${cards[0].name}</p>` :
                    html`<button onClick=${() => {this.startGameHandler()}}>Start game</button>`
                }
            </div>
            `;
        }
    }

    const gameDiv = document.getElementById('game')
    render(html`<${App} />`, gameDiv);
  </script>
  <body>
    <h1>Game ID: <%= id %></h1>
    <div id="game"></div>
  </body>
</html>
